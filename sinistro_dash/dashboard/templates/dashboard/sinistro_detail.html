{% extends "dashboard/base.html" %}
{% block title %}Sinistro #{{ sinistro.id }}{% endblock %}

{% block content %}
<h3 class="mb-3">ðŸš¨ Sinistro #{{ sinistro.id }}</h3>

<div class="card mb-4 shadow-sm">
  <div class="card-body">
    <div class="row">
      <div class="col-md-6">
        <p><strong>Tipo:</strong> {{ sinistro.tipo_principal }} / {{ sinistro.tipo_secundario }}</p>
        <p><strong>EndereÃ§o:</strong> {{ sinistro.endereco }}</p>
        <p><strong>Ponto de referÃªncia:</strong> {{ sinistro.ponto_referencia|default:"â€”" }}</p>
        <p><strong>Data:</strong> {{ sinistro.data_hora }}</p>
        <p><strong>VÃ­tima fatal:</strong> {{ sinistro.houve_vitima_fatal|yesno:"Sim,NÃ£o" }}</p>
      </div>

      <div class="col-md-6">
        <p class="fw-bold mb-1">ðŸ‘¤ Registrado por</p>
        {% if sinistro.usuario %}
          <p>{{ sinistro.usuario.username }} ({{ sinistro.usuario.perfil }})</p>
        {% else %}
          <p class="text-muted">UsuÃ¡rio nÃ£o identificado</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<div class="row mb-4">
  <div class="col-md-12">
    <div id="map" style="height: 400px;" class="rounded shadow-sm"></div>
  </div>
</div>

<h5>ðŸ“¸ Fotos</h5>
{% if sinistro.fotos %}
<div class="row">
  {% for foto in sinistro.fotos %}
  <div class="col-md-3 mb-3">
    <img src="{{ foto.url }}" class="img-fluid rounded shadow-sm">
  </div>
  {% endfor %}
</div>
{% else %}
<p class="text-muted">Nenhuma foto enviada.</p>
{% endif %}

{% endblock %}

{% block extra_js %}
<script>
{% if sinistro.latitude and sinistro.longitude %}
const map = L.map('map').setView(
  [{{ sinistro.latitude }}, {{ sinistro.longitude }}],
  16
);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap'
}).addTo(map);

L.marker([{{ sinistro.latitude }}, {{ sinistro.longitude }}])
  .addTo(map)
  .bindPopup("<strong>Sinistro #{{ sinistro.id }}</strong>")
  .openPopup();
{% else %}
document.getElementById("map").innerHTML =
  "<p class='text-center text-muted mt-4'>LocalizaÃ§Ã£o nÃ£o informada</p>";
{% endif %}
</script>
{% endblock %}
