{% extends "dashboard/base.html" %}
{% block title %}Detalhe do Sinistro{% endblock %}

{% block content %}
<h3 class="mb-3">Sinistro #{{ sinistro.id }}</h3>

<div class="row">
  <div class="col-md-6">
    <p><strong>Tipo:</strong> {{ sinistro.tipo_principal }}</p>
    <p><strong>EndereÃ§o:</strong> {{ sinistro.endereco|default:"NÃ£o informado" }}</p>
    <p><strong>Ponto de referÃªncia:</strong> {{ sinistro.ponto_referencia|default:"â€”" }}</p>
    <p><strong>Data:</strong> {{ sinistro.data_hora }}</p>
    <p><strong>VÃ­tima fatal:</strong> {{ sinistro.houve_vitima_fatal|yesno:"Sim,NÃ£o" }}</p>

    <p class="mt-3">
      <strong>Coordenadas:</strong><br>
      Lat: {{ sinistro.latitude }}<br>
      Lng: {{ sinistro.longitude }}
    </p>
  </div>

  <div class="col-md-6">
    <!-- ðŸ—ºï¸ MAPA -->
    <div id="map" style="height: 350px; border-radius: 8px;" class="shadow-sm"></div>
  </div>
</div>

<hr>

<h5 class="mt-4">ðŸ“¸ Fotos do Sinistro</h5>

{% if sinistro.fotos %}
<div class="row">
  {% for foto in sinistro.fotos %}
  <div class="col-md-3 mb-3">
    <img src="{{ foto.url }}" class="img-fluid rounded shadow-sm" alt="Foto do sinistro">
  </div>
  {% endfor %}
</div>
{% else %}
<p class="text-muted">Nenhuma foto enviada para este sinistro.</p>
{% endif %}

{% endblock %}
{% block extra_js %}
<script>
{% if sinistro.latitude and sinistro.longitude %}
const lat = {{ sinistro.latitude }};
const lng = {{ sinistro.longitude }};

const map = L.map('map').setView([lat, lng], 16);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap'
}).addTo(map);

L.marker([lat, lng])
  .addTo(map)
  .bindPopup(`
    <strong>Sinistro #{{ sinistro.id }}</strong><br>
    {{ sinistro.endereco|default:"Local do sinistro" }}
  `)
  .openPopup();
{% else %}
document.getElementById("map").innerHTML =
  "<p class='text-muted text-center mt-4'>LocalizaÃ§Ã£o nÃ£o informada</p>";
{% endif %}
</script>
{% endblock %}